<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Locker System</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS ‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á */
        body { font-family: 'Sarabun', sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        .hidden { display: none !important; }
        
        h2 { margin-top: 0; color: #333; }
        input { 
            width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; 
            text-align: center; /* ‡∏à‡∏±‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
        }
        
        .btn { width: 100%; padding: 12px; background: #06c755; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin-top: 10px; font-weight: bold; transition: 0.3s; }
        .btn:hover { background: #05b34c; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .btn-secondary { background: #6c757d; }
        .btn-secondary:hover { background: #5a6268; }
        
        /* Grid ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ï‡∏π‡πâ */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
        .l-btn { padding: 20px; border-radius: 10px; border: none; font-size: 18px; font-weight: bold; cursor: pointer; color: white; transition: transform 0.1s; }
        .l-btn:active { transform: scale(0.95); }
        .available { background-color: #28a745; box-shadow: 0 4px #1e7e34; } 
        .occupied { background-color: #dc3545; opacity: 0.6; cursor: not-allowed; }
        .menu-btn { background: #007bff; margin-bottom: 15px; padding: 15px; font-size: 18px; }
    </style>
</head>
<body>

    <div class="container">
        <div id="pageLogin">
            <h2>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö OTP</p>
            <input type="tel" id="loginPhone" placeholder="+66xxxxxxxxx" value="+66">
            <div id="recaptcha-container" style="margin: 10px auto;"></div>
            <button class="btn" onclick="sendOTP()">üì© ‡∏£‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™ OTP</button>
        </div>

        <div id="pageOTP" class="hidden">
            <h2>üì± ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™ OTP</h2>
            <p>‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ 6 ‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ó‡∏≤‡∏á SMS</p>
            <input type="text" id="otpInput" placeholder="123456" maxlength="6" style="letter-spacing: 5px; font-size: 20px;">
            <button class="btn" onclick="verifyOTP()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
            <button class="btn btn-secondary" onclick="location.reload()">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        </div>

        <div id="pageMenu" class="hidden">
            <h2>üì¶ Smart Locker</h2>
            <p id="welcomeUser" style="color:#666; font-size:14px; margin-bottom: 20px;">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</p>
            
            <button class="btn menu-btn" onclick="nav('sender')">üì¶ ‡∏ù‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á / ‡∏à‡∏≠‡∏á‡∏ï‡∏π‡πâ</button>
            <button class="btn menu-btn" style="background:#17a2b8;" onclick="nav('receiver')">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏±‡∏™‡∏î‡∏∏ / ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á</button>
            
            <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
            <button class="btn btn-secondary" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>

        <div id="pageSender" class="hidden">
            <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á</h3>
            <div id="lockerGrid" class="grid">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            
            <div id="reserveForm" class="hidden" style="margin-top:20px; background:#f8f9fa; padding:15px; border-radius:10px;">
                <p style="margin:5px 0;">‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: <b style="color:#007bff; font-size:1.2em;">‡∏ï‡∏π‡πâ <span id="targetLocker">-</span></b></p>
                
                <p style="font-size:14px; color:#555; margin-bottom:5px;">‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö (4 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢)</p>
                <input type="tel" id="rPhone" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1234" maxlength="4" style="font-size: 24px; letter-spacing: 3px; font-weight:bold;">
                
                <button class="btn" onclick="doReserve()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ù‡∏≤‡∏Å</button>
            </div>
            <button class="btn btn-secondary" style="margin-top:20px;" onclick="nav('menu')">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</button>
        </div>

        <div id="pageReceiver" class="hidden">
            <h3>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏±‡∏™‡∏î‡∏∏</h3>
            <p>‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç 4 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</p>
            
            <input type="tel" id="sPhone" placeholder="xxxx" maxlength="4" style="font-size: 24px; letter-spacing: 3px; font-weight:bold;">
            
            <button class="btn" onclick="doSearch()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
            <div id="resultBox" style="margin-top:15px;"></div>
            <button class="btn btn-secondary" style="margin-top:20px;" onclick="nav('menu')">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <script>
        // 1. Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÉ‡∏™‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß)
        const firebaseConfig = {
          apiKey: "AIzaSyDnPenoLXFdVPtUUR3z9lQACAeS6WZcyyU",
          authDomain: "dropnlock-b9699.firebaseapp.com",
          projectId: "dropnlock-b9699",
          storageBucket: "dropnlock-b9699.firebasestorage.app",
          messagingSenderId: "971185135920",
          appId: "1:971185135920:web:f208fe01f1773d257428f5",
          measurementId: "G-JV5HQTG9FB"
        };
        // URL Google Apps Script ‡πÄ‡∏î‡∏¥‡∏°
        const API_URL = "https://script.google.com/macros/s/AKfycby5p-MrPS_NcSz0GSEcy5FrMfnZRB5MYrw66bWjTGeVBowfd-nXwZTUPlGA_gbS0dQUCg/exec";

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        auth.languageCode = 'th';

        // 2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≥‡∏£‡∏´‡∏±‡∏™ (LINE ‡∏à‡∏≥‡∏¢‡∏≤‡∏ß / Web ‡∏à‡∏≥‡∏™‡∏±‡πâ‡∏ô)
        const isLineApp = /Line/i.test(navigator.userAgent);
        auth.setPersistence(isLineApp ? firebase.auth.Auth.Persistence.LOCAL : firebase.auth.Auth.Persistence.SESSION)
            .catch(e=>console.error("Persistence Error:", e));

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏£‡∏∞‡∏ö‡∏ö
        let confirmationResult = null;
        let currentUserPhone = "";
        let selectedLocker = null;

        // 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Main Logic)
        auth.onAuthStateChanged((user) => {
            const allPages = ['pageLogin', 'pageOTP', 'pageMenu', 'pageSender', 'pageReceiver'];
            
            if (user) {
                // --> ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                currentUserPhone = user.phoneNumber; // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ (+66xxxx)
                console.log("Logged in:", currentUserPhone);
                document.getElementById('welcomeUser').innerText = "‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: " + currentUserPhone;
                
                // ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Login
                document.getElementById('pageLogin').classList.add('hidden');
                document.getElementById('pageOTP').classList.add('hidden');
                
                // ‡πÄ‡∏ä‡πá‡∏Ñ Deep Link
                checkDeepLink();
            } else {
                // --> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
                allPages.forEach(id => document.getElementById(id)?.classList.add('hidden'));
                document.getElementById('pageLogin').classList.remove('hidden');
                renderRecaptcha(); // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Captcha
            }
        });

        function checkDeepLink() {
            const params = new URLSearchParams(window.location.search);
            const page = params.get('page');
            if (page === 'sender') nav('sender');
            else if (page === 'receiver') nav('receiver');
            else nav('menu');
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ---
        function nav(p) {
            ['pageMenu', 'pageSender', 'pageReceiver'].forEach(id => document.getElementById(id).classList.add('hidden'));
            
            if(p=='menu') document.getElementById('pageMenu').classList.remove('hidden');
            
            if(p=='sender') { 
                document.getElementById('pageSender').classList.remove('hidden'); 
                loadLockers(); 
                document.getElementById('rPhone').value = ""; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ä‡πà‡∏≠‡∏á
            }
            
            if(p=='receiver') { 
                document.getElementById('pageReceiver').classList.remove('hidden'); 
                document.getElementById('resultBox').innerHTML=""; 
                
                // ‚úÖ ‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞: ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏î‡πÄ‡∏≠‡∏≤ 4 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏¢
                if(currentUserPhone && currentUserPhone.length > 4) {
                    document.getElementById('sPhone').value = currentUserPhone.slice(-4);
                }
            }
        }

        // --- Recaptcha (‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡πä‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ã‡πâ‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß) ---
        function renderRecaptcha() {
            const container = document.getElementById('recaptcha-container');
            if(container && container.hasChildNodes()) {
                return; // ‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
            }
            if (!window.recaptchaVerifier) {
                window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', { size: 'normal' });
                window.recaptchaVerifier.render();
            }
        }

        // --- ‡∏™‡πà‡∏á SMS OTP ---
        function sendOTP() {
            const ph = document.getElementById('loginPhone').value;
            if (ph.length < 10) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
            
            const btn = event.target;
            btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á..."; btn.disabled = true;
            
            renderRecaptcha(); // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á

            auth.signInWithPhoneNumber(ph, window.recaptchaVerifier).then((res) => {
                confirmationResult = res;
                document.getElementById('pageLogin').classList.add('hidden');
                document.getElementById('pageOTP').classList.remove('hidden');
                alert("‚úÖ ‡∏™‡πà‡∏á OTP ‡πÅ‡∏•‡πâ‡∏ß");
                btn.innerText = "‡∏£‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™ OTP"; btn.disabled = false;
            }).catch(e => { 
                alert("Error: " + e.message); 
                btn.innerText = "‡∏£‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™ OTP"; btn.disabled = false;
                if(window.recaptchaWidgetId) grecaptcha.reset(window.recaptchaWidgetId);
            });
        }

        function verifyOTP() {
            const code = document.getElementById('otpInput').value;
            if(!code) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™");
            confirmationResult.confirm(code).catch(() => alert("‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î"));
        }

        function logout() {
            if(confirm("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?")) auth.signOut().then(() => window.location.href = window.location.pathname);
        }

        // --- ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏π‡πâ ---
        async function loadLockers() {
            const grid = document.getElementById('lockerGrid');
            grid.innerHTML = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...";
            try {
                const res = await fetch(API_URL + "?action=checkStatus");
                const data = await res.json();
                grid.innerHTML = "";
                data.forEach(x => {
                    let btn = document.createElement('button');
                    let isFree = x.status === 'Available';
                    btn.className = `l-btn ${isFree?'available':'occupied'}`;
                    btn.innerHTML = `‡∏ï‡∏π‡πâ ${x.locker}<br><span style="font-size:0.8em">${isFree?'‡∏ß‡πà‡∏≤‡∏á':'‡πÄ‡∏ï‡πá‡∏°'}</span>`;
                    btn.disabled = !isFree;
                    if(isFree) btn.onclick = () => {
                        selectedLocker = x.locker;
                        document.getElementById('targetLocker').innerText = x.locker;
                        document.getElementById('reserveForm').classList.remove('hidden');
                        document.getElementById('reserveForm').scrollIntoView({behavior:'smooth'});
                    };
                    grid.appendChild(btn);
                });
            } catch(e) { grid.innerHTML = "Error loading"; }
        }

        // --- ‡∏à‡∏≠‡∏á‡∏ï‡∏π‡πâ (‡∏™‡πà‡∏á 4 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢) ---
        async function doReserve() {
            const ph = document.getElementById('rPhone').value;
            
            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç 4 ‡∏´‡∏•‡∏±‡∏Å‡πÑ‡∏´‡∏°
            if(!/^\d{4}$/.test(ph)) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç 4 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
            
            const btn = event.target;
            btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å..."; btn.disabled = true;
            try {
                await fetch(API_URL, { 
                    method:'POST', 
                    body:JSON.stringify({
                        action:'reserve', 
                        locker:selectedLocker, 
                        phone:ph, // ‡∏™‡πà‡∏á‡πÅ‡∏Ñ‡πà 4 ‡∏ï‡∏±‡∏ß‡πÑ‡∏õ‡πÄ‡∏Å‡πá‡∏ö
                        sender:currentUserPhone
                    }) 
                });
                alert("‚úÖ ‡∏ù‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (‡∏£‡∏´‡∏±‡∏™‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏≠ " + ph + ")"); 
                nav('menu');
            } catch(e) { alert("Error"); }
            btn.innerText = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ù‡∏≤‡∏Å"; btn.disabled = false;
        }

        // --- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡πÉ‡∏ä‡πâ 4 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢) ---
        async function doSearch() {
            const ph = document.getElementById('sPhone').value;
            
            if(!/^\d{4}$/.test(ph)) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç 4 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢");
            
            const box = document.getElementById('resultBox');
            box.innerHTML = "üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...";
            try {
                const res = await fetch(`${API_URL}?action=find&phone=${ph}`);
                const data = await res.json();
                if(data.found) {
                    box.innerHTML = `<div style="background:#d4edda; padding:15px; border-radius:10px;"><h3>üéâ ‡∏û‡∏ö‡∏û‡∏±‡∏™‡∏î‡∏∏!</h3><p>‡∏ï‡∏π‡πâ ${data.locker}</p><button class="btn" onclick="doClear('${data.locker}')">‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á</button></div>`;
                } else {
                    box.innerHTML = `<div style="background:#f8d7da; padding:15px; border-radius:10px; color:red;">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏û‡∏±‡∏™‡∏î‡∏∏ (‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢ ${ph})</div>`;
                }
            } catch(e) { box.innerHTML = "Error"; }
        }

        // --- ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á/‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ï‡∏π‡πâ ---
        async function doClear(n) {
            if(!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á?")) return;
            await fetch(API_URL, { method:'POST', body:JSON.stringify({action:'clear', locker:n}) });
            alert("‡∏ï‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß"); nav('menu');
        }
    </script>
</body>
</html>